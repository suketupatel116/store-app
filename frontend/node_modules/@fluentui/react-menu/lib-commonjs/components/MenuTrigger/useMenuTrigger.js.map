{"version":3,"sources":["useMenuTrigger.js"],"sourcesContent":["import * as React from 'react';\nimport { useMenuContext_unstable } from '../../contexts/menuContext';\nimport { useIsSubmenu } from '../../utils/useIsSubmenu';\nimport { useFocusFinders, useRestoreFocusTarget } from '@fluentui/react-tabster';\nimport { useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\nimport { ArrowRight, ArrowLeft, Escape, ArrowDown } from '@fluentui/keyboard-keys';\nimport { applyTriggerPropsToChildren, getTriggerChild, isHTMLElement, mergeCallbacks, useEventCallback, useMergedRefs } from '@fluentui/react-utilities';\nimport { useARIAButtonProps } from '@fluentui/react-aria';\n/**\n * Create the state required to render MenuTrigger.\n * Clones the only child component and adds necessary event handling behaviours to open a popup menu\n *\n * @param props - props from this instance of MenuTrigger\n */ export const useMenuTrigger_unstable = (props)=>{\n    const { children , disableButtonEnhancement =false  } = props;\n    const triggerRef = useMenuContext_unstable((context)=>context.triggerRef);\n    const menuPopoverRef = useMenuContext_unstable((context)=>context.menuPopoverRef);\n    const setOpen = useMenuContext_unstable((context)=>context.setOpen);\n    const open = useMenuContext_unstable((context)=>context.open);\n    const triggerId = useMenuContext_unstable((context)=>context.triggerId);\n    const openOnHover = useMenuContext_unstable((context)=>context.openOnHover);\n    const openOnContext = useMenuContext_unstable((context)=>context.openOnContext);\n    const restoreFocusTargetAttribute = useRestoreFocusTarget();\n    const isSubmenu = useIsSubmenu();\n    const { findFirstFocusable  } = useFocusFinders();\n    const focusFirst = React.useCallback(()=>{\n        const firstFocusable = findFirstFocusable(menuPopoverRef.current);\n        firstFocusable === null || firstFocusable === void 0 ? void 0 : firstFocusable.focus();\n    }, [\n        findFirstFocusable,\n        menuPopoverRef\n    ]);\n    const openedWithKeyboardRef = React.useRef(false);\n    const hasMouseMoved = React.useRef(false);\n    const { dir  } = useFluent();\n    const OpenArrowKey = dir === 'ltr' ? ArrowRight : ArrowLeft;\n    const child = getTriggerChild(children);\n    const onContextMenu = (event)=>{\n        if (isTargetDisabled(event)) {\n            return;\n        }\n        if (openOnContext) {\n            event.preventDefault();\n            setOpen(event, {\n                open: true,\n                keyboard: false,\n                type: 'menuTriggerContextMenu',\n                event\n            });\n        }\n    };\n    const onClick = (event)=>{\n        if (isTargetDisabled(event)) {\n            return;\n        }\n        if (!openOnContext) {\n            setOpen(event, {\n                open: !open,\n                keyboard: openedWithKeyboardRef.current,\n                type: 'menuTriggerClick',\n                event\n            });\n            openedWithKeyboardRef.current = false;\n        }\n    };\n    const onKeyDown = (event)=>{\n        if (isTargetDisabled(event)) {\n            return;\n        }\n        const key = event.key;\n        if (!openOnContext && (isSubmenu && key === OpenArrowKey || !isSubmenu && key === ArrowDown)) {\n            setOpen(event, {\n                open: true,\n                keyboard: true,\n                type: 'menuTriggerKeyDown',\n                event\n            });\n        }\n        if (key === Escape && !isSubmenu) {\n            setOpen(event, {\n                open: false,\n                keyboard: true,\n                type: 'menuTriggerKeyDown',\n                event\n            });\n        }\n        // if menu is already open, can't rely on effects to focus\n        if (open && key === OpenArrowKey && isSubmenu) {\n            focusFirst();\n        }\n    };\n    const onMouseEnter = (event)=>{\n        if (isTargetDisabled(event)) {\n            return;\n        }\n        if (openOnHover && hasMouseMoved.current) {\n            setOpen(event, {\n                open: true,\n                keyboard: false,\n                type: 'menuTriggerMouseEnter',\n                event\n            });\n        }\n    };\n    // Opening a menu when a mouse hasn't moved and just entering the trigger is a bad a11y experience\n    // First time open the mouse using mousemove and then continue with mouseenter\n    // Only use once to determine that the user is using the mouse since it is an expensive event to handle\n    const onMouseMove = (event)=>{\n        if (isTargetDisabled(event)) {\n            return;\n        }\n        if (openOnHover && !hasMouseMoved.current) {\n            setOpen(event, {\n                open: true,\n                keyboard: false,\n                type: 'menuTriggerMouseMove',\n                event\n            });\n            hasMouseMoved.current = true;\n        }\n    };\n    const onMouseLeave = (event)=>{\n        if (isTargetDisabled(event)) {\n            return;\n        }\n        if (openOnHover) {\n            setOpen(event, {\n                open: false,\n                keyboard: false,\n                type: 'menuTriggerMouseLeave',\n                event\n            });\n        }\n    };\n    const contextMenuProps = {\n        id: triggerId,\n        ...child === null || child === void 0 ? void 0 : child.props,\n        ref: useMergedRefs(triggerRef, child === null || child === void 0 ? void 0 : child.ref),\n        onMouseEnter: useEventCallback(mergeCallbacks(child === null || child === void 0 ? void 0 : child.props.onMouseEnter, onMouseEnter)),\n        onMouseLeave: useEventCallback(mergeCallbacks(child === null || child === void 0 ? void 0 : child.props.onMouseLeave, onMouseLeave)),\n        onContextMenu: useEventCallback(mergeCallbacks(child === null || child === void 0 ? void 0 : child.props.onContextMenu, onContextMenu)),\n        onMouseMove: useEventCallback(mergeCallbacks(child === null || child === void 0 ? void 0 : child.props.onMouseMove, onMouseMove))\n    };\n    const triggerChildProps = {\n        'aria-haspopup': 'menu',\n        'aria-expanded': !open && !isSubmenu ? undefined : open,\n        ...restoreFocusTargetAttribute,\n        ...contextMenuProps,\n        onClick: useEventCallback(mergeCallbacks(child === null || child === void 0 ? void 0 : child.props.onClick, onClick)),\n        onKeyDown: useEventCallback(mergeCallbacks(child === null || child === void 0 ? void 0 : child.props.onKeyDown, onKeyDown))\n    };\n    const ariaButtonTriggerChildProps = useARIAButtonProps((child === null || child === void 0 ? void 0 : child.type) === 'button' || (child === null || child === void 0 ? void 0 : child.type) === 'a' ? child.type : 'div', triggerChildProps);\n    return {\n        isSubmenu,\n        children: applyTriggerPropsToChildren(children, openOnContext ? contextMenuProps : disableButtonEnhancement ? triggerChildProps : ariaButtonTriggerChildProps)\n    };\n};\nconst isTargetDisabled = (event)=>{\n    const isDisabled = (el)=>el.hasAttribute('disabled') || el.hasAttribute('aria-disabled') && el.getAttribute('aria-disabled') === 'true';\n    if (isHTMLElement(event.target) && isDisabled(event.target)) {\n        return true;\n    }\n    return isHTMLElement(event.currentTarget) && isDisabled(event.currentTarget);\n};\n"],"names":["useMenuTrigger_unstable","props","children","disableButtonEnhancement","triggerRef","useMenuContext_unstable","context","menuPopoverRef","setOpen","open","triggerId","openOnHover","openOnContext","restoreFocusTargetAttribute","useRestoreFocusTarget","isSubmenu","useIsSubmenu","findFirstFocusable","useFocusFinders","focusFirst","React","useCallback","firstFocusable","current","focus","openedWithKeyboardRef","useRef","hasMouseMoved","dir","useFluent","OpenArrowKey","ArrowRight","ArrowLeft","child","getTriggerChild","onContextMenu","event","isTargetDisabled","preventDefault","keyboard","type","onClick","onKeyDown","key","ArrowDown","Escape","onMouseEnter","onMouseMove","onMouseLeave","contextMenuProps","id","ref","useMergedRefs","useEventCallback","mergeCallbacks","triggerChildProps","undefined","ariaButtonTriggerChildProps","useARIAButtonProps","applyTriggerPropsToChildren","isDisabled","el","hasAttribute","getAttribute","isHTMLElement","target","currentTarget"],"mappings":"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"}