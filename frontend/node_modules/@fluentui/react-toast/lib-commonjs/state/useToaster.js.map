{"version":3,"sources":["useToaster.js"],"sourcesContent":["import * as React from 'react';\nimport { isHTMLElement, useEventCallback, useForceUpdate } from '@fluentui/react-utilities';\nimport { useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\nimport { createToaster } from './vanilla';\nimport { EVENTS } from './constants';\nexport function useToaster(options = {}) {\n    const forceUpdate = useForceUpdate();\n    const { toasterId: userToasterId , shortcuts  } = options;\n    // Currently the toaster options can never be changed at runtime\n    const [toaster] = React.useState(()=>createToaster(options));\n    const { targetDocument  } = useFluent();\n    const lastActiveElementRef = React.useRef(null);\n    const isCorrectToaster = useEventCallback((toasterId)=>{\n        return toasterId === userToasterId;\n    });\n    const isFocusShortcut = useEventCallback((e)=>{\n        if (shortcuts === null || shortcuts === void 0 ? void 0 : shortcuts.focus) {\n            return shortcuts.focus(e);\n        }\n    });\n    const tryRestoreFocus = React.useCallback(()=>{\n        var _lastActiveElementRef_current;\n        (_lastActiveElementRef_current = lastActiveElementRef.current) === null || _lastActiveElementRef_current === void 0 ? void 0 : _lastActiveElementRef_current.focus();\n        lastActiveElementRef.current = null;\n    }, []);\n    const pauseAllToasts = React.useCallback(()=>{\n        toaster.visibleToasts.forEach((toastId)=>{\n            var _toast_imperativeRef_current;\n            const toast = toaster.toasts.get(toastId);\n            (_toast_imperativeRef_current = toast === null || toast === void 0 ? void 0 : toast.imperativeRef.current) === null || _toast_imperativeRef_current === void 0 ? void 0 : _toast_imperativeRef_current.pause();\n        });\n    }, [\n        toaster\n    ]);\n    const playAllToasts = React.useCallback(()=>{\n        toaster.visibleToasts.forEach((toastId)=>{\n            var _toast_imperativeRef_current;\n            const toast = toaster.toasts.get(toastId);\n            (_toast_imperativeRef_current = toast === null || toast === void 0 ? void 0 : toast.imperativeRef.current) === null || _toast_imperativeRef_current === void 0 ? void 0 : _toast_imperativeRef_current.play();\n        });\n    }, [\n        toaster\n    ]);\n    const getMostRecentVisibleToast = React.useCallback(()=>{\n        return Array.from(toaster.visibleToasts).reduce((cur, next)=>{\n            const toast = toaster.toasts.get(next);\n            if (!toast) {\n                return cur;\n            }\n            if (!cur) {\n                return toast;\n            }\n            if (cur.order < (toast === null || toast === void 0 ? void 0 : toast.order)) {\n                return toast;\n            }\n            return cur;\n        }, undefined);\n    }, [\n        toaster\n    ]);\n    React.useEffect(()=>{\n        if (!targetDocument) {\n            return;\n        }\n        const addToastListener = (eventType, callback)=>{\n            const listener = (e)=>{\n                if (!isCorrectToaster(e.detail.toasterId)) {\n                    return;\n                }\n                callback(e);\n                forceUpdate();\n            };\n            targetDocument.addEventListener(eventType, listener);\n            return ()=>targetDocument.removeEventListener(eventType, listener);\n        };\n        const buildToast = (e)=>{\n            toaster.buildToast(e.detail, forceUpdate);\n        };\n        const dismissToast = (e)=>{\n            toaster.dismissToast(e.detail.toastId);\n        };\n        const updateToast = (e)=>{\n            toaster.updateToast(e.detail);\n        };\n        const dismissAllToasts = (e)=>{\n            toaster.dismissAllToasts();\n        };\n        const pauseToast = (e)=>{\n            const toast = toaster.toasts.get(e.detail.toastId);\n            if (toast) {\n                var _toast_imperativeRef_current;\n                (_toast_imperativeRef_current = toast.imperativeRef.current) === null || _toast_imperativeRef_current === void 0 ? void 0 : _toast_imperativeRef_current.pause();\n            }\n        };\n        const playToast = (e)=>{\n            const toast = toaster.toasts.get(e.detail.toastId);\n            if (toast) {\n                var _toast_imperativeRef_current;\n                (_toast_imperativeRef_current = toast.imperativeRef.current) === null || _toast_imperativeRef_current === void 0 ? void 0 : _toast_imperativeRef_current.play();\n            }\n        };\n        const cleanupBuildListener = addToastListener(EVENTS.show, buildToast);\n        const cleanupUpdateListener = addToastListener(EVENTS.update, updateToast);\n        const cleanupDismissListener = addToastListener(EVENTS.dismiss, dismissToast);\n        const cleanupDismissAllListener = addToastListener(EVENTS.dismissAll, dismissAllToasts);\n        const cleanupPauseListener = addToastListener(EVENTS.pause, pauseToast);\n        const cleanupPlayListener = addToastListener(EVENTS.play, playToast);\n        const focusShortcutListener = (e)=>{\n            if (isFocusShortcut(e)) {\n                pauseAllToasts();\n                const mostRecentToast = getMostRecentVisibleToast();\n                if (mostRecentToast) {\n                    var _mostRecentToast_imperativeRef_current;\n                    lastActiveElementRef.current = isHTMLElement(targetDocument.activeElement) ? targetDocument.activeElement : null;\n                    (_mostRecentToast_imperativeRef_current = mostRecentToast.imperativeRef.current) === null || _mostRecentToast_imperativeRef_current === void 0 ? void 0 : _mostRecentToast_imperativeRef_current.focus();\n                }\n            }\n        };\n        targetDocument.addEventListener('keydown', focusShortcutListener);\n        return ()=>{\n            cleanupBuildListener();\n            cleanupDismissAllListener();\n            cleanupUpdateListener();\n            cleanupDismissListener();\n            cleanupPauseListener();\n            cleanupPlayListener();\n            targetDocument.removeEventListener('keydown', focusShortcutListener);\n        };\n    }, [\n        toaster,\n        forceUpdate,\n        targetDocument,\n        isCorrectToaster,\n        pauseAllToasts,\n        getMostRecentVisibleToast,\n        isFocusShortcut\n    ]);\n    const toastsToRender = (()=>{\n        if (!toaster) {\n            return new Map();\n        }\n        const toRender = new Map();\n        const toasts = Array.from(toaster.toasts.values());\n        toasts.forEach((toast)=>{\n            const { position  } = toast;\n            toRender.has(position) || toRender.set(position, []);\n            if (position.startsWith('bottom')) {\n                toRender.get(position).push(toast);\n            } else {\n                toRender.get(position).unshift(toast);\n            }\n        });\n        return toRender;\n    })();\n    return {\n        isToastVisible: toaster.isToastVisible,\n        toastsToRender,\n        pauseAllToasts,\n        playAllToasts,\n        tryRestoreFocus\n    };\n}\n"],"names":["useToaster","options","forceUpdate","useForceUpdate","toasterId","userToasterId","shortcuts","toaster","React","useState","createToaster","targetDocument","useFluent","lastActiveElementRef","useRef","isCorrectToaster","useEventCallback","isFocusShortcut","e","focus","tryRestoreFocus","useCallback","_lastActiveElementRef_current","current","pauseAllToasts","visibleToasts","forEach","toastId","_toast_imperativeRef_current","toast","toasts","get","imperativeRef","pause","playAllToasts","play","getMostRecentVisibleToast","Array","from","reduce","cur","next","order","undefined","useEffect","addToastListener","eventType","callback","listener","detail","addEventListener","removeEventListener","buildToast","dismissToast","updateToast","dismissAllToasts","pauseToast","playToast","cleanupBuildListener","EVENTS","show","cleanupUpdateListener","update","cleanupDismissListener","dismiss","cleanupDismissAllListener","dismissAll","cleanupPauseListener","cleanupPlayListener","focusShortcutListener","mostRecentToast","_mostRecentToast_imperativeRef_current","isHTMLElement","activeElement","toastsToRender","Map","toRender","values","position","has","set","startsWith","push","unshift","isToastVisible"],"mappings":"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"}