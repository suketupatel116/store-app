{"version":3,"sources":["useRovingTabIndexes.ts"],"sourcesContent":["import { useMergedRefs } from '@fluentui/react-utilities';\nimport * as React from 'react';\nimport { HTMLElementFilter, useHTMLElementWalkerRef } from './useHTMLElementWalker';\n\n/**\n * https://www.w3.org/WAI/ARIA/apg/practices/keyboard-interface/#kbd_roving_tabindex\n */\nexport function useRovingTabIndex(filter?: HTMLElementFilter) {\n  const currentElementRef = React.useRef<HTMLElement>();\n  const [walkerRef, rootRef] = useHTMLElementWalkerRef(filter);\n\n  const rootRefCallback = (element?: HTMLElement) => {\n    if (!element) {\n      return;\n    }\n    reset();\n  };\n\n  function reset() {\n    if (!walkerRef.current) {\n      return;\n    }\n    const walker = walkerRef.current;\n    walker.currentElement = walker.root;\n    let tabbableChild = walker.firstChild(element =>\n      element.tabIndex === 0 ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_SKIP,\n    );\n    walker.currentElement = walker.root;\n    tabbableChild ??= walker.firstChild();\n    if (!tabbableChild) {\n      if (process.env.NODE_ENV === 'development') {\n        // eslint-disable-next-line no-console\n        console.warn('useRovingTabIndexes: internal error, no tabbable element was found');\n      }\n      return;\n    }\n    tabbableChild.tabIndex = 0;\n    currentElementRef.current = tabbableChild;\n    let nextElement: HTMLElement | null = null;\n    while ((nextElement = walker.nextElement()) && nextElement !== tabbableChild) {\n      nextElement.tabIndex = -1;\n    }\n  }\n  function rove(nextElement: HTMLElement) {\n    if (!currentElementRef.current) {\n      return;\n    }\n    currentElementRef.current.tabIndex = -1;\n    nextElement.tabIndex = 0;\n    nextElement.focus();\n    currentElementRef.current = nextElement;\n  }\n\n  return [\n    {\n      rove,\n      reset,\n    },\n    useMergedRefs(rootRef, rootRefCallback) as React.Ref<HTMLElement>,\n  ] as const;\n}\n"],"names":["useMergedRefs","React","useHTMLElementWalkerRef","useRovingTabIndex","filter","currentElementRef","useRef","walkerRef","rootRef","rootRefCallback","element","reset","current","walker","currentElement","root","tabbableChild","firstChild","tabIndex","NodeFilter","FILTER_ACCEPT","FILTER_SKIP","process","env","NODE_ENV","console","warn","nextElement","rove","focus"],"mappings":"AAAA,SAASA,aAAa,QAAQ,4BAA4B;AAC1D,YAAYC,WAAW,QAAQ;AAC/B,SAA4BC,uBAAuB,QAAQ,yBAAyB;AAEpF;;CAEC,GACD,OAAO,SAASC,kBAAkBC,MAA0B,EAAE;IAC5D,MAAMC,oBAAoBJ,MAAMK,MAAM;IACtC,MAAM,CAACC,WAAWC,QAAQ,GAAGN,wBAAwBE;IAErD,MAAMK,kBAAkB,CAACC,UAA0B;QACjD,IAAI,CAACA,SAAS;YACZ;QACF,CAAC;QACDC;IACF;IAEA,SAASA,QAAQ;QACf,IAAI,CAACJ,UAAUK,OAAO,EAAE;YACtB;QACF,CAAC;QACD,MAAMC,SAASN,UAAUK,OAAO;QAChCC,OAAOC,cAAc,GAAGD,OAAOE,IAAI;QACnC,IAAIC,gBAAgBH,OAAOI,UAAU,CAACP,CAAAA,UACpCA,QAAQQ,QAAQ,KAAK,IAAIC,WAAWC,aAAa,GAAGD,WAAWE,WAAW;QAE5ER,OAAOC,cAAc,GAAGD,OAAOE,IAAI;QACnCC,0BAAAA,2BAAAA,gBAAAA,gBAAkBH,OAAOI,UAAU,EAAE;QACrC,IAAI,CAACD,eAAe;YAClB,IAAIM,QAAQC,GAAG,CAACC,QAAQ,KAAK,eAAe;gBAC1C,sCAAsC;gBACtCC,QAAQC,IAAI,CAAC;YACf,CAAC;YACD;QACF,CAAC;QACDV,cAAcE,QAAQ,GAAG;QACzBb,kBAAkBO,OAAO,GAAGI;QAC5B,IAAIW,cAAkC,IAAI;QAC1C,MAAO,AAACA,CAAAA,cAAcd,OAAOc,WAAW,EAAC,KAAMA,gBAAgBX,cAAe;YAC5EW,YAAYT,QAAQ,GAAG,CAAC;QAC1B;IACF;IACA,SAASU,KAAKD,WAAwB,EAAE;QACtC,IAAI,CAACtB,kBAAkBO,OAAO,EAAE;YAC9B;QACF,CAAC;QACDP,kBAAkBO,OAAO,CAACM,QAAQ,GAAG,CAAC;QACtCS,YAAYT,QAAQ,GAAG;QACvBS,YAAYE,KAAK;QACjBxB,kBAAkBO,OAAO,GAAGe;IAC9B;IAEA,OAAO;QACL;YACEC;YACAjB;QACF;QACAX,cAAcQ,SAASC;KACxB;AACH,CAAC"}