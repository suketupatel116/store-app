{"version":3,"sources":["focusVisiblePolyfill.js"],"sourcesContent":["import { isHTMLElement } from '@fluentui/react-utilities';\nimport { KEYBORG_FOCUSIN, createKeyborg, disposeKeyborg } from 'keyborg';\nimport { FOCUS_VISIBLE_ATTR } from './constants';\n/**\n * @internal\n * @param scope - Applies the ponyfill to all DOM children\n * @param targetWindow - window\n */ export function applyFocusVisiblePolyfill(scope, targetWindow) {\n    if (alreadyInScope(scope)) {\n        // Focus visible polyfill already applied at this scope\n        return ()=>undefined;\n    }\n    const state = {\n        current: undefined\n    };\n    const keyborg = createKeyborg(targetWindow);\n    // When navigation mode changes remove the focus-visible selector\n    keyborg.subscribe((isNavigatingWithKeyboard)=>{\n        if (!isNavigatingWithKeyboard && state.current) {\n            removeFocusVisibleClass(state.current);\n            state.current = undefined;\n        }\n    });\n    // Keyborg's focusin event is delegated so it's only registered once on the window\n    // and contains metadata about the focus event\n    const keyborgListener = (e)=>{\n        if (state.current) {\n            removeFocusVisibleClass(state.current);\n            state.current = undefined;\n        }\n        if (keyborg.isNavigatingWithKeyboard() && isHTMLElement(e.target) && e.target) {\n            // Griffel can't create chained global styles so use the parent element for now\n            state.current = e.target;\n            applyFocusVisibleClass(state.current);\n        }\n    };\n    // Make sure that when focus leaves the scope, the focus visible class is removed\n    const blurListener = (e)=>{\n        if (!e.relatedTarget || isHTMLElement(e.relatedTarget) && !scope.contains(e.relatedTarget)) {\n            if (state.current) {\n                removeFocusVisibleClass(state.current);\n                state.current = undefined;\n            }\n        }\n    };\n    scope.addEventListener(KEYBORG_FOCUSIN, keyborgListener);\n    scope.addEventListener('focusout', blurListener);\n    scope.focusVisible = true;\n    // Return disposer\n    return ()=>{\n        scope.removeEventListener(KEYBORG_FOCUSIN, keyborgListener);\n        scope.removeEventListener('focusout', blurListener);\n        delete scope.focusVisible;\n        disposeKeyborg(keyborg);\n    };\n}\nfunction applyFocusVisibleClass(el) {\n    el.setAttribute(FOCUS_VISIBLE_ATTR, '');\n}\nfunction removeFocusVisibleClass(el) {\n    el.removeAttribute(FOCUS_VISIBLE_ATTR);\n}\nfunction alreadyInScope(el) {\n    if (!el) {\n        return false;\n    }\n    if (el.focusVisible) {\n        return true;\n    }\n    return alreadyInScope(el === null || el === void 0 ? void 0 : el.parentElement);\n}\n"],"names":["applyFocusVisiblePolyfill","scope","targetWindow","alreadyInScope","undefined","state","current","keyborg","createKeyborg","subscribe","isNavigatingWithKeyboard","removeFocusVisibleClass","keyborgListener","e","isHTMLElement","target","applyFocusVisibleClass","blurListener","relatedTarget","contains","addEventListener","KEYBORG_FOCUSIN","focusVisible","removeEventListener","disposeKeyborg","el","setAttribute","FOCUS_VISIBLE_ATTR","removeAttribute","parentElement"],"mappings":";;;;+BAOoBA;;aAAAA;;gCAPU;yBACiC;2BAC5B;AAKxB,SAASA,0BAA0BC,KAAK,EAAEC,YAAY,EAAE;IAC/D,IAAIC,eAAeF,QAAQ;QACvB,uDAAuD;QACvD,OAAO,IAAIG;IACf,CAAC;IACD,MAAMC,QAAQ;QACVC,SAASF;IACb;IACA,MAAMG,UAAUC,IAAAA,sBAAa,EAACN;IAC9B,iEAAiE;IACjEK,QAAQE,SAAS,CAAC,CAACC,2BAA2B;QAC1C,IAAI,CAACA,4BAA4BL,MAAMC,OAAO,EAAE;YAC5CK,wBAAwBN,MAAMC,OAAO;YACrCD,MAAMC,OAAO,GAAGF;QACpB,CAAC;IACL;IACA,kFAAkF;IAClF,8CAA8C;IAC9C,MAAMQ,kBAAkB,CAACC,IAAI;QACzB,IAAIR,MAAMC,OAAO,EAAE;YACfK,wBAAwBN,MAAMC,OAAO;YACrCD,MAAMC,OAAO,GAAGF;QACpB,CAAC;QACD,IAAIG,QAAQG,wBAAwB,MAAMI,IAAAA,6BAAa,EAACD,EAAEE,MAAM,KAAKF,EAAEE,MAAM,EAAE;YAC3E,+EAA+E;YAC/EV,MAAMC,OAAO,GAAGO,EAAEE,MAAM;YACxBC,uBAAuBX,MAAMC,OAAO;QACxC,CAAC;IACL;IACA,iFAAiF;IACjF,MAAMW,eAAe,CAACJ,IAAI;QACtB,IAAI,CAACA,EAAEK,aAAa,IAAIJ,IAAAA,6BAAa,EAACD,EAAEK,aAAa,KAAK,CAACjB,MAAMkB,QAAQ,CAACN,EAAEK,aAAa,GAAG;YACxF,IAAIb,MAAMC,OAAO,EAAE;gBACfK,wBAAwBN,MAAMC,OAAO;gBACrCD,MAAMC,OAAO,GAAGF;YACpB,CAAC;QACL,CAAC;IACL;IACAH,MAAMmB,gBAAgB,CAACC,wBAAe,EAAET;IACxCX,MAAMmB,gBAAgB,CAAC,YAAYH;IACnChB,MAAMqB,YAAY,GAAG,IAAI;IACzB,kBAAkB;IAClB,OAAO,IAAI;QACPrB,MAAMsB,mBAAmB,CAACF,wBAAe,EAAET;QAC3CX,MAAMsB,mBAAmB,CAAC,YAAYN;QACtC,OAAOhB,MAAMqB,YAAY;QACzBE,IAAAA,uBAAc,EAACjB;IACnB;AACJ;AACA,SAASS,uBAAuBS,EAAE,EAAE;IAChCA,GAAGC,YAAY,CAACC,6BAAkB,EAAE;AACxC;AACA,SAAShB,wBAAwBc,EAAE,EAAE;IACjCA,GAAGG,eAAe,CAACD,6BAAkB;AACzC;AACA,SAASxB,eAAesB,EAAE,EAAE;IACxB,IAAI,CAACA,IAAI;QACL,OAAO,KAAK;IAChB,CAAC;IACD,IAAIA,GAAGH,YAAY,EAAE;QACjB,OAAO,IAAI;IACf,CAAC;IACD,OAAOnB,eAAesB,OAAO,IAAI,IAAIA,OAAO,KAAK,IAAI,KAAK,IAAIA,GAAGI,aAAa;AAClF"}